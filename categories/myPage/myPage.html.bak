<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="blog.css">
    <title>Title</title>
</head>
<body id="public">
<canvas id = "mycanvas" width="1600px" height="800px";></canvas>
<script type="text/javascript">
    var flag=false;
    window.onload = function(){
        canvas = document.getElementById("mycanvas");
        ctx = canvas.getContext("2d");
        focallength = 250;
        var particleArr = getImgData("精彩！Go");
        var pause = false;
        var timer;
        //初始化位置
        initMove();

        function initMove(){
            particleArr.forEach(function(){
                this.locx =parseInt(Math.random()*canvas.width);
                this.locy =parseInt(Math.random()*canvas.height);
                this.locz =Math.random()*focallength*2 - focallength;
                this.x =parseInt(Math.random()*canvas.width);
                this.y =parseInt(Math.random()*canvas.height);
                this.z = Math.random()*focallength*2 - focallength;
                this.paint();
            });
            startMove();
        }

        //速度
        var lastTime;
        var derection = true;
        function startMove(){
            clearInterval(timer);
            var thisTime = new Date();
            ctx.clearRect(0,0,canvas.width , canvas.height);
            particleArr.forEach(function(){
                var particle = this;
                if(derection){
                    if (Math.abs(particle.disx - particle.x) < 0.1 && Math.abs(particle.disy - particle.y) < 0.1 && Math.abs(particle.disz - particle.z)<0.1) {
                        particle.x = particle.disx;
                        particle.y = particle.disy;
                        particle.z = particle.disz;
                        if(thisTime - lastTime > 300){
                            derection = false;
                        }
                    }else{
                        particle.x = particle.x + (particle.disx - particle.x) * 0.1;
                        particle.y = particle.y + (particle.disy - particle.y) * 0.1;
                        particle.z = particle.z + (particle.disz - particle.z) * 0.1;
                        lastTime = new Date()
                    }
                }else{
                    if (Math.abs(particle.locx - particle.x) < 0.1 && Math.abs(particle.locy - particle.y) < 0.1 && Math.abs(particle.locz - particle.z)<0.1) {
                        particle.x = particle.locx;
                        particle.y = particle.locy;
                        particle.z = particle.locz;
                        pause = true;
                        clearInterval(timer);
                        move();
                    }else{
                        particle.x = particle.x + (particle.locx - particle.x) * 0.1;
                        particle.y = particle.y + (particle.locy - particle.y) * 0.1;
                        particle.z = particle.z + (particle.locz - particle.z) * 0.1;
                        pause = false;
                    }
                }
                particle.paint();
            });
            if(!pause) {
                if("requestAnimationFrame" in window){
                    requestAnimationFrame(startMove);
                }
                else if("webkitRequestAnimationFrame" in window){
                    webkitRequestAnimationFrame(startMove);
                }
                else if("msRequestAnimationFrame" in window){
                    msRequestAnimationFrame(startMove);
                }
                else if("mozRequestAnimationFrame" in window){
                    mozRequestAnimationFrame(startMove);
                }
            }
        }
        function move(){
            timer = setInterval(makeParticle,10)
        }
        function makeParticle(){
            ctx.clearRect(0,0,1432,768);
            for(var i = 0 ; i < particleArr.length; i++){
                var particle = particleArr[i];
                particle.paint();
            }
        }
        //window.location.href="myPage.html";

    }
    //定义粒子 构造函数
    var Particle = function(x,y,z,r){
        this.disx = x;//文字锁定的位置
        this.disy = y;
        this.disz = z;
        this.x = x;
        this.y = y;
        this.z = z;
        this.locx = 0;
        this.locy = 0;//   运动前位置
        this.locz = 0;
        this.radius = r;
        this.col = "rgba("+parseInt(Math.random()*255)+","+parseInt(Math.random()*255)+","+parseInt(Math.random()*255)+",1)";
    }
    Particle.prototype={
        paint:function(){
            ctx.save();
            ctx.beginPath();
            var scale = focallength/(focallength + this.z);
            ctx.arc(canvas.width/2 + (this.x-canvas.width/2)*scale , canvas.height/2 + (this.y-canvas.height/2) * scale, this.radius*scale , 0 , 2*Math.PI);
            ctx.fillStyle = "rgba("+parseInt(Math.random()*255)+","+parseInt(Math.random()*255)+","+parseInt(Math.random()*255)+","+ scale +")";
            ctx.fill()
            ctx.restore();
        }
    }
    Array.prototype.forEach = function(callback){
        for(var i=0;i<this.length;i++){
            callback.call(this[i]);
        }
    }
    //根据getImageData接口重绘文字
    function getImgData(text){
        drawText(text);
        var imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
        ctx.clearRect(0,0,canvas.width,canvas.height);
        var newArr = [];
        for(var i = 0 ; i < imgData.width ; i +=6){
            for(var j = 0 ; j < imgData.height ; j+=6){
                var num = (j*imgData.width+i)*4;
                if(imgData.data[num]>=128){
                    var particle = new Particle(i-3,j-3,0,3);
                    newArr.push(particle);
                }
            }
        }
        return newArr
    }
    //画字
    function drawText(text){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.save();
        ctx.font = "150px Cooper Std Black bold";
        ctx.fillStyle ="rgba(255,255,255,1)";//纯色 方便扫面
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(text , canvas.width/2 , canvas.height/2);
        ctx.restore();

    }

</script>

<!--
<header>
    <div class="userMsg">
        <span class="name">轻刻美</span>
        <span class="line">&nbsp;|&nbsp;</span>
        <span class="motto">因在努力,果在随缘</span>
    </div>
    <nav>
        <ul>
            <li><a href="">精文汇总</a></li>
            <li><a href="">学习</a></li>
            <li><a href="">生活</a></li>
            <li><a href="">随笔</a></li>
        </ul>
    </nav>

</header>
-->
<div class="wrap">
    <div class="menu hide">
        <div class="bar top"></div>
        <div class="bar center"></div>
        <div class="bar bottom"></div>
    </div>
    <div class="menu_wrap hide">
        <div class="menuDetail">
            <a href="../studies/index.html">学习</a>
            <a href="../lives/index.html">生活</a>
            <a href="">随笔</a>
        </div>
    </div>
</div>
<div class="content">
    <header>
        <div class="userMsg">
            <span></span>
        </div>
        <div class="echo">
        </div>
    </header>
    <section id="part1" class="run">
        <img class="run" src="images/2.png">
        <div class="textExp">
            <p>轻刻美的自我小介绍</p>
        </div>
        <a href="#part2" class="scroll"></a>
    </section>
    <section id="part2">
        <img src="images/studies.png">
        <div class="textExp">
            <p>学习的介绍</p>
        </div>
        <a href="#part3" class="scroll"></a>
    </section>
    <section id="part3">
        <img src="images/2.png">
        <div class="textExp">
            <p>生活的介绍</p>
        </div>
        <a href="#part4" class="scroll"></a>
    </section>
    <section id="part4">
        <img src="images/studies.png">
        <div class="textExp">
            <p>随笔的介绍</p>
        </div>
        <a href="#part5" class="scroll"></a>
    </section>
    <section id="part5">
        <img src="images/studies.png">
        <div class="textExp">
            <p>footer部分</p>
        </div>
    </section>
</div>
<script type='text/javascript', src='jquery-1.7.2.min.js'></script>
<script type='text/javascript', src='jquery.easing.min.js'></script>
<script type='text/javascript', src='jquery.scrollify.min.js'></script>
<script type='text/javascript', src='blog.js'></script>
</body>
</html>